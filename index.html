<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏û (‡∏£‡∏û.‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏© - Offline Mode)</title>
    <script async src="https://docs.opencv.org/4.5.4/opencv.js" type="text/javascript" onload="onOpenCvReady()"></script>
    <style>
        :root { --primary: #0d9488; --bg: #f8fafc; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); padding: 20px; text-align: center; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .canvas-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; }
        canvas { max-width: 100%; border: 2px solid #e2e8f0; border-radius: 8px; background: #000; }
        .btn-group { margin: 20px 0; display: flex; justify-content: center; gap: 10px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-green { background: #059669; color: white; }
        .btn-exudate { background: #d97706; color: white; }
        .status { color: #64748b; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color:var(--primary)">üè• ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏£‡∏≠‡∏¢‡πÇ‡∏£‡∏Ñ (Non-AI)</h1>
    <p>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á <strong>‡∏£‡∏û.‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©</strong></p>
    
    <div id="cv-status" class="status">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏°‡∏≠‡∏á‡∏Å‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏†‡∏≤‡∏û...</div>

    <div style="margin: 20px 0; padding: 20px; border: 2px dashed #cbd5e1; border-radius: 10px;">
        <input type="file" id="file-input" accept="image/*" style="display: none;">
        <button class="btn" style="background:#475569; color:white;" onclick="document.getElementById('file-input').click()">üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏à‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡∏ï‡∏≤</button>
    </div>

    <div class="btn-group">
        <button class="btn btn-green" onclick="applyRedFree()">üü¢ Red-Free Filter (‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å)</button>
        <button class="btn btn-exudate" onclick="applyExudateEnhance()">üü° ‡πÄ‡∏ô‡πâ‡∏ô‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏£‡∏±‡πà‡∏ß (Hard Exudates)</button>
        <button class="btn" style="background:#94a3b8; color:white;" onclick="resetImage()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏†‡∏≤‡∏û</button>
    </div>

    <div class="canvas-container">
        <div>
            <p><strong>‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</strong></p>
            <canvas id="canvas-input"></canvas>
        </div>
        <div>
            <p><strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</strong></p>
            <canvas id="canvas-output"></canvas>
        </div>
    </div>
</div>

<script>
    let imgElement = new Image();
    let fileInput = document.getElementById('file-input');

    fileInput.onchange = (e) => {
        imgElement.src = URL.createObjectURL(e.target.files[0]);
    };

    imgElement.onload = () => {
        let src = cv.imread(imgElement);
        cv.imshow('canvas-input', src);
        cv.imshow('canvas-output', src);
        src.delete();
    };

    function onOpenCvReady() {
        document.getElementById('cv-status').innerText = "‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á 100%)";
        document.getElementById('cv-status').style.color = "#059669";
    }

    // üü¢ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Red-Free Filter (‡πÄ‡∏ô‡πâ‡∏ô Hemorrhages/Microaneurysms)
    function applyRedFree() {
        let src = cv.imread(imgElement);
        let planes = new cv.MatVector();
        cv.split(src, planes); // ‡πÅ‡∏¢‡∏Å‡∏™‡∏µ RGB
        
        let green = planes.get(1); // ‡∏î‡∏∂‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
        let dst = new cv.Mat();
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° Contrast ‡∏î‡πâ‡∏ß‡∏¢ CLAHE
        let clahe = new cv.CLAHE(3.0, new cv.Size(8, 8));
        clahe.apply(green, dst);
        
        cv.imshow('canvas-output', dst);
        src.delete(); planes.delete(); green.delete(); dst.delete();
    }

    // üü° ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ô‡πâ‡∏ô‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏£‡∏±‡πà‡∏ß (Hard Exudates)
    function applyExudateEnhance() {
        let src = cv.imread(imgElement);
        let gray = new cv.Mat();
        cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
        
        // ‡πÉ‡∏ä‡πâ Threshold ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
        let dst = new cv.Mat();
        cv.adaptiveThreshold(gray, dst, 255, cv.ADAPTIVE_THRESH_GAUSSIAN_C, cv.THRESH_BINARY, 11, -10);
        
        cv.imshow('canvas-output', dst);
        src.delete(); gray.delete(); dst.delete();
    }

    function resetImage() {
        let src = cv.imread(imgElement);
        cv.imshow('canvas-output', src);
        src.delete();
    }
</script>
</body>
</html>
